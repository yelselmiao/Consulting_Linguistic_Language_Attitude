---
title: "Analysis III"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

1) Variables to look at:

- Race (last column. But many students have not answered. So I’m not sure you’ll be able to do anything with this!)

- Gender (same here, not sure you can do the stats on this, many women + too few men)

- Where they grew up (that’s a column I added)

- # of languages spoken 

- # of years of studying French

- origin of teachers  (done)

No need to look at their field of study. I didn’t translate that column.

2) The scale is the same:

1: I strongly agree

2: I agree

3: I slightly agree

4: I slightly disagree

5: I disagree

6. I strongly disagree




```{r Load Package, message=FALSE}
library(readxl)
library(ggplot2)

library(scales)
library(tidyverse)
library(tidyr)
library(tidytext)
library(reshape2)

library(ggpubr)
library(rstatix)
library(broom)
```


```{r load data}
#Les_diffe_rents_accents_du_franc_ais_November_1_2021_ENG_for_Shuyi <- read_excel(paste0(here::here(), "Data/Les différents accents du français - November 1 2021 - ENG for Shuyi.xlsx"))

raw_data <- Les_diffe_rents_accents_du_franc_ais_November_1_2021_ENG_for_Shuyi

data <- raw_data[-1, ]

names(data)
```

```{r rename columns}
data <- data %>%
  select(-c(Q43...144, ...147, QID18_1, QID18_2, QID18_3, QID18_4,
            QID18_5, QID18_6, QID18_7, QID18_8, QID18_9, QID18_10, QID19)) %>%
  rename(gender = Q1,
         gender_other = Q1_4_TEXT, 
         age = Q2,
         country_of_birth = Q3,
         grow_up_country = ...8, 
         grow_up_province = Q41,
         grow_up_city = Q4,
         field_of_study = Q5,
         num_of_language = Q6,
         spoken_language = Q42, 
         #spoken_language_other = Q42_11_TEXT,
         mother_tongue = Q7,
         mother_tongue_other = Q7_11_TEXT,
         year_of_french = Q8,
         french_speaking_place = Q9,
         french_speaking_place_other = Q9_6_TEXT,
         month_live_in_fr_env = Q43...18,
         type_of_french = Q10,
         type_of_french_other = Q10_3_TEXT,
         teacher_origin = Q11, 
         teacher_origin_other = Q11_3_TEXT,
         race = RACE
         )
```

# Summary Statistics

```{r gender prop}
data %>% 
  group_by(gender) %>%
  tally()
```


```{r race prop}
data %>% 
  group_by(race) %>% 
  tally()
```


```{r Grow-up Country: Canada or not}
data %>% 
  filter(str_detect(grow_up_country, 'Canada')) %>% 
  group_by(grow_up_country) %>% 
  tally()
# Out of 143 people who have answered this question, 99 people grew up in Canada, and another 9 people grew in both Canada and some other country. 



data %>% 
  drop_na(grow_up_country) %>% 
  filter(str_detect(grow_up_country, ',') |
           str_detect(grow_up_country, 'and'))%>% 
  group_by(grow_up_country) %>% 
  tally()

# 13 people grew up in more than one country 


data %>% 
  drop_na(grow_up_country) %>% 
  filter(!str_detect(grow_up_country, ',') &
         !str_detect(grow_up_country, 'and')) %>% 
  filter(grow_up_country != 'Canada') %>% 
  mutate(grow_up_continent = case_when(grow_up_country %in% c('Brunei Darussalam', 'China','Hong Kong (S.A.R.)','India','Indonesia',
                                                      'Iran','Japan','Kazakhstan','Malaysia', 'South Korea', 'Turkey',
                                                      'United Arab Emirates', 'Vietnam', 'Paskistan') ~ 'Asia',
                               grow_up_country %in% c('Czech Republic', 'Russia', 'UK', 'Ukraine') ~ 'Europe',
                               grow_up_country %in% c('Colombia','Dominica', 'United States of America', 'USA', 'Brazil') ~ 'America',
                               grow_up_country %in% c('Ethiopia','Dominica') ~ 'Africa'
                               )) %>% 
  group_by(grow_up_continent) %>% 
  tally() 

# For 140 people grew up in one country, excluding 99 who grew up in Canada, 25 ppl grew up in Asia, 10 grew up in America, 5 in Europe, amd one in Africa. 
```

```{r Num of Language}
data %>% 
  group_by(num_of_language) %>%
  mutate(num_of_language = replace(num_of_language, num_of_language == '+ de 5', '>5'),
         num_of_language = replace(num_of_language, num_of_language == '1', '2')) %>% 
  tally() %>%
  arrange(desc(n)) %>% 
  mutate(per =`n`/sum(`n`),
  label = paste0(n, ' (', scales::percent(per), ')'))
```

```{r year of studying french}
data <- data %>%  mutate(year_of_french = replace(year_of_french, year_of_french == '18 ans', '18'),
                         year_of_french = replace(year_of_french, year_of_french == '9 ans', '9')) 
data$year_of_french

data %>% 
  mutate(year_of_french = as.numeric(year_of_french)) %>% 
  mutate(year_group = case_when(year_of_french <= 5 ~ "0 - 5",
                                year_of_french > 5 & year_of_french <= 10 ~ "5 - 10",
                                year_of_french > 10 & year_of_french <= 15 ~"10 - 15",
                                year_of_french > 15 ~ "> 15")) %>%
  group_by(year_group) %>%
  tally() %>% 
  drop_na() %>% 
  mutate(per =`n`/sum(`n`),
  label = paste0(n, ' (', scales::percent(per), ')'))


```

# Make long-format data

```{r make long data}
#names(data)

rec_data <- data %>% 
  select(c(2, 8, 10, 15, 23:132, 134)) %>% 
  mutate(year_of_french = as.numeric(year_of_french)) %>%
  select(-c(`1B`, `2B`, `3B`, `4B`, `4B`, `5B`, `6B`, `7B`, `8B`, `9B`, `10B`)) %>% 
  mutate(multi_grow_up = ifelse(str_detect(grow_up_country, "and|,"), TRUE, FALSE), 
         grew_up_canada = ifelse(str_detect(grow_up_country, "Canada|canada"), TRUE, FALSE), 
         study_year_group = case_when(year_of_french <= 5~"0 - 5",
                                year_of_french > 5 & year_of_french <= 10 ~"5 - 10",
                                year_of_french > 10 & year_of_french <= 15 ~"10 - 15",
                                year_of_french > 15~"> 15"),
         id = 1: nrow(data),
         id = as.factor(id)) %>% 
  relocate(id, .before = gender) %>% 
  mutate(across(c(6:105), as.numeric)) 

# reverse the scale for the question "strong accent? "
accent_cols <- rec_data %>% 
  select(contains('_4')) %>%
  names

rec_data[,accent_cols] = lapply(accent_cols,  function(x) 7 - rec_data[, x])

# sum up the score
rec_data <- rec_data %>% 
   mutate(block_1 = rowSums(.[6:15]),
         block_2 = rowSums(.[16:25]),
         block_3 = rowSums(.[26:35]),
         block_4 = rowSums(.[36:45]),
         block_5 = rowSums(.[46:55]),
         block_6 = rowSums(.[56:65]),
         block_7 = rowSums(.[66:75]),
         block_8 = rowSums(.[76:85]),
         block_9 = rowSums(.[86:94]),
         block_10 = rowSums(.[96:105]))



recording_df_long <- rec_data %>% 
  select(-c(6:105)) %>%
  pivot_longer(cols = starts_with("block"), names_to = "block",values_to = "score")  %>%
  mutate(speaker_race = case_when(block %in% c('block_1', 'block_4', 'block_7', 'block_8', 'block_9')~'white',
                          block %in% c('block_2', 'block_3', 'block_5', 'block_6', 'block_10')~'black'),
         speaker_accent = case_when(block %in% c('block_1', 'block_6')~'Quebec',
                            block %in% c('block_2', 'block_9')~'European',
                            block %in% c('block_3', 'block_8')~'Acadian',
                            block %in% c('block_4', 'block_10')~'English',
                            block %in% c('block_5', 'block_7')~'African')) 


# replace English accent as 
recording_df_long <- recording_df_long %>% 
  mutate(speaker_accent = replace(speaker_accent, speaker_accent == 'English', 'L2 French'))
```

```{r long data for speaker accent}
rec_long_accent <- recording_df_long %>% 
  # dplyr::select(id,speaker_accent, speaker_race, block, score) %>% 
  group_by(id, speaker_accent) %>%
  summarise(score = sum(score, na.rm = TRUE)) %>% 
  left_join(rec_data, on = 'id')
```


```{r long data for speaker race}
rec_long_race <- recording_df_long %>% 
  # dplyr::select(id,speaker_accent, speaker_race, block, score) %>% 
  group_by(id, speaker_race) %>%
  summarise(score = sum(score, na.rm = TRUE)) %>% 
  left_join(rec_data, on = 'id')
```



# Viz & Statistics Tests 

## Effect of speaker accent

```{r boxplot & line plot: gender vs. speaker accent}
rec_long_accent %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(gender, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE), 
            count = n()) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=gender))+
  geom_point() + 
  geom_line(aes(group = gender)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete(name = 'Gender', labels=c("Male (N = 39)","Female (N = 114)")) + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 


rec_long_accent %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=gender)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Respondent Gender') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  
```



```{r wilcox test: gender vs. speaker accent}
# for each accent
rec_long_accent %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ gender, alternative = 'less', paired = FALSE)

# no significant difference
```




```{r lineplot & boxplot: grew_up in Canada vs. Speaker Accent}
rec_long_accent %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(grew_up_canada, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE), 
            count = n()) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=grew_up_canada))+
  geom_point() + 
  geom_line(aes(group = grew_up_canada)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Grew up in Canada', labels=c("FALSE (N = 35)","TRUE (N = 108)")) + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 



rec_long_accent %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=grew_up_canada)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Grew up in Canada') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  

```

```{r wilcox test: grew_up in Canada vs. Speaker Accent}
# for each accent
rec_long_accent %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ grew_up_canada, paired = FALSE)

# rec_long_accent %>%
#   filter(is.na(grew_up_canada) == FALSE) %>%
#   wilcox_test(score ~ grew_up_canada, paired = FALSE)
```

```{r boxplot: multi grew up country vs. Speaker Accent}
rec_long_accent %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(multi_grow_up, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE), 
            count = n()) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=multi_grow_up))+
  geom_point() + 
  geom_line(aes(group = multi_grow_up)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Grew up in more than one country', labels=c("FALSE (N = 140)","TRUE (N = 13)")) + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 



rec_long_accent %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=multi_grow_up)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Grew up in More than One Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  

```



```{r wilcox test: multi grew up country vs. Speaker Accent (each & overall)}
# for each accent
rec_long_accent %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ multi_grow_up, paired = FALSE)
```

```{r boxplot: Grew up Continent/Country vs. Speaker Accent, fig.height=3, fig.width=6}
continent_df <- rec_long_accent %>% 
  filter(multi_grow_up == FALSE) %>% 
  mutate(grow_up_continent = case_when(grow_up_country %in% c('Brunei Darussalam', 'China','Hong Kong (S.A.R.)','India','Indonesia',
                                                      'Iran','Japan','Kazakhstan','Malaysia', 'South Korea', 'Turkey',
                                                      'United Arab Emirates', 'Vietnam', 'Paskistan') ~ 'Asia',
                               grow_up_country %in% c('Czech Republic', 'Russia', 'UK', 'Ukraine') ~ 'Europe',
                               grow_up_country %in% c('Colombia','Dominica', 'United States of America', 'USA', 'Brazil') ~ 'America',
                               grow_up_country %in% c('Ethiopia','Dominica') ~ 'Africa',
                               grow_up_country == 'Canada' ~ 'Canada'
                               ),
         grow_up_continent = as.factor(grow_up_continent)) 


# continent_df %>% 
#   # remove Africa because there is only one respondent
#   filter(grow_up_continent != 'Africa') %>% 
#   ggplot(aes(y = score, x = speaker_accent, fill=grow_up_continent)) +
#   geom_boxplot() + 
#   theme_bw() + 
#   labs(x = 'Speaker Accent', y = 'Score',fill='Grew up Continent/Country') + 
#   theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
#         axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
#         strip.text = element_text(size=12),
#         axis.text.y = element_text(size = 10),
#         axis.text.x= element_text(size = 10, hjust = 0.5))  


continent_df %>% 
  # remove Africa because there is only one respondent
  filter(grow_up_continent != 'Africa') %>% 
  ggplot(aes(y = score, x = grow_up_continent, fill=grow_up_continent)) +
  geom_boxplot() + 
  facet_wrap(~speaker_accent) + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Grew up Continent/Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))


continent_df %>% 
  # remove Africa because there is only one respondent
  filter(grow_up_continent != 'Africa') %>% 
  group_by(grow_up_continent, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=grow_up_continent))+
  geom_point() + 
  geom_line(aes(group = grow_up_continent)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Grew up Continent/Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 
  
```

```{r KW Test: Grew up Continent/Country vs. Speaker Accent}
continent_df  %>%
  group_by(speaker_accent) %>%
  kruskal_test(score ~ grow_up_continent) 

# post-hoc
European <- continent_df %>% filter(speaker_accent == 'European')
FSA::dunnTest(score ~ grow_up_continent, data = European, method = 'holm')
#dunn.test(European$score, European$grow_up_continent, method = 'holm')
```



- # of languages spoken 

```{r viz: # of languages spoken: by accent,fig.height = 3, fig.width = 6}

recording_df_long %>%
  mutate(
    num_of_language = replace(num_of_language, num_of_language == '+ de 5', '5'),
    num_of_language = replace(num_of_language, num_of_language == '1', '2'),
    num_of_language_numeric = as.numeric(num_of_language)
  ) %>%
  ggplot(aes(x = num_of_language_numeric, y = score)) +
  geom_jitter() +
  scale_x_continuous(breaks = seq(0, 5, by = 1)) + 
  geom_smooth(method = lm) +
  facet_grid( ~ speaker_accent) +
  theme_bw() + 
  labs(x = 'Number of Languages Spoken', y = 'Score') + 
  scale_colour_discrete('Number of Languages Spoken') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 


```

```{r corr: # of language vs. speaker accent}
num_of_lan_df <- rec_long_accent %>% 
  dplyr::select(speaker_accent, score, num_of_language) %>%
  #filter(speaker_accent == 'Quebec') %>%
  mutate(num_of_language = replace(num_of_language, num_of_language == '+ de 5', '5')) %>% 
  drop_na()


# treat num_of_language as rank
 num_of_lan_df %>% 
   mutate(num_of_language = as.numeric(num_of_language)) %>% 
   group_by(speaker_accent) %>% 
   summarise(spear_cor = round(cor(score, num_of_language, method = 'spearman'),3),
             spear_p_value = round(cor.test(score, num_of_language, method = 'spearman', exact = FALSE)$p.value,3))
  

```





- # of years of studying French

```{r viz: year of french: by accent,fig.height = 3, fig.width = 6}
rec_long_accent %>%
  mutate(year_of_french = as.numeric(year_of_french)) %>% 
  ggplot(aes(x = year_of_french, y = score)) +
  geom_jitter() +
  geom_smooth(method = 'glm') +
  facet_grid( ~ speaker_accent) +
  theme_bw() + 
  labs(x = 'Years of Learning French', y = 'Score') + 
  scale_colour_discrete('Grew up Continent/Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 
```





```{r cor: year of french vs. accent}

# correlation analysis
rec_long_accent %>%
  mutate(year_of_french = as.numeric(year_of_french)) %>% 
  group_by(speaker_accent) %>% 
  summarise(pearson_cor = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$estimate,3),
            pearson_p = round(cor.test(year_of_french, score, method = 'pearson', exact = FALSE)$p.value,3),
            )


rec_long_accent %>% 
  mutate(study_year_group_encoded = case_when(study_year_group == "0 - 5"~1,
                                study_year_group == "5 - 10"~2,
                                study_year_group == "10 - 15"~3,
                                study_year_group == "> 15"~4)) %>% 
  group_by(speaker_accent) %>% 
  summarise(spearman_cor = round(cor.test(study_year_group_encoded, score, method = 'spearman', exact = FALSE)$estimate,3),
            spearman_p = round(cor.test(study_year_group_encoded, score, method = 'spearman', exact = FALSE)$p.value,3),
            kendall_cor = round(cor.test(study_year_group_encoded, score, method = 'kendall', exact = FALSE)$estimate,3),
            kendall_p = round(cor.test(study_year_group_encoded, score, method = 'kendall', exact = FALSE)$p.value,3))
          
```





## Effect of speaker race

```{r boxplot: gender vs. speaker race}
rec_long_race %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  ggplot(aes(y = score, x = speaker_race, fill=gender)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Respsondent Gender') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  
```




```{r wilcox test: gender vs. speaker race}
# for each race
rec_long_race %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(speaker_race) %>% 
  wilcox_test(score ~ gender, paired = FALSE)





rec_long_race %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(gender) %>% 
  wilcox_test(score ~ speaker_race, paired = FALSE)
```

```{r Boxplot: grew up vs. Speaker Race}
recording_df_long %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_race, fill=grew_up_canada)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Grew up in Canada') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  



recording_df_long %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_race, fill=multi_grow_up)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Grew up in More than One Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  


continent_df %>% 
  # remove Africa because there is only one respondent
  filter(grow_up_continent != 'Africa') %>% 
  ggplot(aes(y = score, x = speaker_race, fill=grow_up_continent)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Race', y = 'Score',fill='Grew up Continent/Country') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5))  
```





```{r wilcox test: grew_up in Canada vs. Speaker race}
# for each speaker race
# neither significant 
rec_long_race %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(speaker_race) %>% 
  wilcox_test(score ~ grew_up_canada, paired = FALSE)



rec_long_race %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(grew_up_canada) %>% 
  wilcox_test(score ~ speaker_race, paired = FALSE)
```

```{r wilcox test: multiple grew_up vs. Speaker race}
# for each speaker race
# both significant 
rec_long_race %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(speaker_race) %>% 
  wilcox_test(score ~ multi_grow_up, paired = FALSE)

rec_long_race %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(multi_grow_up) %>% 
  wilcox_test(score ~ speaker_race, paired = FALSE)

```

```{r KW Test: grew up continent/place vs. speaker race}
continent_df_race <- rec_long_race %>% 
  filter(multi_grow_up == FALSE) %>% 
  mutate(grow_up_continent = case_when(grow_up_country %in% c('Brunei Darussalam', 'China','Hong Kong (S.A.R.)','India','Indonesia',
                                                      'Iran','Japan','Kazakhstan','Malaysia', 'South Korea', 'Turkey',
                                                      'United Arab Emirates', 'Vietnam', 'Paskistan') ~ 'Asia',
                               grow_up_country %in% c('Czech Republic', 'Russia', 'UK', 'Ukraine') ~ 'Europe',
                               grow_up_country %in% c('Colombia','Dominica', 'United States of America', 'USA', 'Brazil') ~ 'America',
                               grow_up_country %in% c('Ethiopia','Dominica') ~ 'Africa',
                               grow_up_country == 'Canada' ~ 'Canada'
                               ),
         grow_up_continent = as.factor(grow_up_continent)) 

# for each speaker race
# both significant 
continent_df_race  %>%
  group_by(speaker_race) %>%
  kruskal_test(score ~ grow_up_continent) 

continent_df_race  %>%
  group_by(grow_up_continent) %>%
  kruskal_test(score ~ speaker_race) 
```

```{r cor: num of language vs. race}
num_of_lan_df_race <- rec_long_race %>% 
  dplyr::select(speaker_race, score, num_of_language) %>%
  #filter(speaker_accent == 'Quebec') %>%
  mutate(num_of_language = replace(num_of_language, num_of_language == '+ de 5', '5')) %>% 
  drop_na()


# treat num_of_language as rank
 num_of_lan_df_race %>% 
   mutate(num_of_language = as.numeric(num_of_language)) %>% 
   group_by(speaker_race) %>% 
   summarise(spear_cor = round(cor(score, num_of_language, method = 'spearman'),3),
             spear_p_value = round(cor.test(score, num_of_language, method = 'spearman', exact = FALSE)$p.value,3))
 

```

```{r cor: year of French vs. race}
# year of French
 rec_long_race %>% 
   mutate(year_of_french = as.numeric(year_of_french)) %>% 
   filter(is.na(year_of_french) == FALSE) %>%
   group_by(speaker_race) %>% 
   summarise(pearson_cor = round(cor(score, year_of_french, method = 'pearson'),3),
             pearson_p_value = round(cor.test(score, year_of_french, method = 'pearson', exact = FALSE)$p.value,3))


# year of French by five-year


rec_long_race %>% 
  mutate(study_year_group_encoded = case_when(study_year_group == "0 - 5"~1,
                                study_year_group == "5 - 10"~2,
                                study_year_group == "10 - 15"~3,
                                study_year_group == "> 15"~4)) %>% 
  group_by(speaker_race) %>% 
  summarise(spearman_cor = round(cor.test(study_year_group_encoded, score, method = 'spearman', exact = FALSE)$estimate,3),
            spearman_p = round(cor.test(study_year_group_encoded, score, method = 'spearman', exact = FALSE)$p.value,3),
            kendall_cor = round(cor.test(study_year_group_encoded, score, method = 'kendall', exact = FALSE)$estimate,3),
            kendall_p = round(cor.test(study_year_group_encoded, score, method = 'kendall', exact = FALSE)$p.value,3))
```





```{r # of languages spoken: by race (model)}
recording_df_long %>%
  mutate(
    num_of_language = replace(num_of_language, num_of_language == '+ de 5', '5'),
    num_of_language = as.numeric(num_of_language)
  ) %>%
  ggplot(aes(x = num_of_language, y = score)) +
  geom_point() +
  geom_smooth(method = 'glm') +
  facet_grid( ~ speaker_race) +
  theme_bw()
  
  
mol_num_lang_race <- recording_df_long %>% 
  mutate(
    num_of_language = replace(num_of_language, num_of_language == '+ de 5', '5'),
    num_of_language = as.numeric(num_of_language)
  ) %>%
  group_by(speaker_race) %>% 
  do(model = lm(score ~ num_of_language, data = .)) 

  
for (i in 1:2){
  print(broom::tidy(mol_num_lang_race$model[[i]]))
}  
```



```{r # of years of studying French: by race (model)}
mols_year_group_race <- recording_df_long %>% 
  mutate(study_year_group_encoded = case_when(study_year_group == "0 - 5"~1,
                                study_year_group == "5 - 10"~2,
                                study_year_group == "10 - 15"~3,
                                study_year_group == "> 15"~4)) %>% 
  group_by(speaker_race) %>% 
  do(model = lm(score ~ study_year_group_encoded, data = .))

for (i in 1:2){
  print(broom::tidy(mols_year_group_race$model[[i]]))
}
```


```{r # of years of studying French: by accent, fig.width=8, fig.height = 4; model}
# recording_df_long %>% 
#   group_by(speaker_accent) %>% 
#   mutate(year_of_french = as.numeric(year_of_french)) %>%
#   ggplot(aes(x = year_of_french, y = score)) + 
#   geom_point() + 
#   geom_smooth(method = 'glm') + 
#   facet_grid(~speaker_accent) + 
#   theme_bw()
# 
# mols <- recording_df_long %>% 
#   mutate(year_of_french = as.numeric(year_of_french)) %>%
#   group_by(speaker_accent) %>% 
#   do(model = lm(score ~ year_of_french, data = .))
# 
# for (i in 1:5){
#   print(broom::tidy(mols$model[[i]]))
# }
# 
# 
# mols_year_group <- recording_df_long %>% 
#   mutate(study_year_group_encoded = case_when(study_year_group == "0 - 5"~1,
#                                 study_year_group == "5 - 10"~2,
#                                 study_year_group == "10 - 15"~3,
#                                 study_year_group == "> 15"~4)) %>% 
#   group_by(speaker_accent) %>% 
#   do(model = lm(score ~ study_year_group_encoded, data = .))
# 
# for (i in 1:5){
#   print(broom::tidy(mols_year_group$model[[i]]))
# }


# recording_df_long %>% 
#   group_by(speaker_accent) %>% 
#   mutate(study_year_group_encoded = case_when(study_year_group == "0 - 5"~1,
#                                 study_year_group == "5 - 10"~2,
#                                 study_year_group == "10 - 15"~3,
#                                 study_year_group == "> 15"~4)) %>% 
#   ggplot(aes(x = study_year_group_encoded, y = score)) + 
#   geom_point() + 
#   geom_smooth(method = 'glm') + 
#   facet_grid(~speaker_accent) + 
#   theme_bw()
```


```{r}
rec_long_race %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(gender) %>% 
  wilcox_test(score ~ speaker_race)
```




```{r comparsion within group, message=FALSE, warning=FALSE}
# gender 
bind_cols(
rec_long_race %>% 
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(gender, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(gender %in% c('Woman', 'Man')) %>%
  group_by(gender) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))

##################################################################  Grow up in Canada & multi grow up

# Grow up in Canada 
bind_cols(
rec_long_race %>% 
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(grew_up_canada, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(grew_up_canada) == FALSE) %>%
  group_by(grew_up_canada) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))



# grow up in more than one country
bind_cols(
rec_long_race %>% 
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(multi_grow_up, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(multi_grow_up) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))

################################################################# country/continent growing up
continent_df_race <- rec_long_race %>% 
  filter(multi_grow_up == FALSE) %>% 
  mutate(grow_up_continent = case_when(grow_up_country %in% c('Brunei Darussalam', 'China','Hong Kong (S.A.R.)','India','Indonesia',
                                                      'Iran','Japan','Kazakhstan','Malaysia', 'South Korea', 'Turkey',
                                                      'United Arab Emirates', 'Vietnam', 'Paskistan') ~ 'Asia',
                               grow_up_country %in% c('Czech Republic', 'Russia', 'UK', 'Ukraine') ~ 'Europe',
                               grow_up_country %in% c('Colombia','Dominica', 'United States of America', 'USA', 'Brazil') ~ 'America',
                               grow_up_country %in% c('Ethiopia','Dominica') ~ 'Africa',
                               grow_up_country == 'Canada' ~ 'Canada'
                               ),
         grow_up_continent = as.factor(grow_up_continent)) 


# country/continent growing up

bind_cols(
continent_df_race %>% 
  #filter(is.na() == FALSE) %>%
  group_by(grow_up_continent, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

continent_df_race %>%
  #filter(is.na(multi_grow_up) == FALSE) %>%
  group_by(grow_up_continent) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))



```


## Analysis of respsondent race 

1) White (34) vs non-White (59)  

2) White (34), Chinese (22), and others (37).   


```{r update the long dataset}
# take a glace at races of respondents 
(race_info <- data %>% 
  dplyr::select(race) %>% 
  #filter(is.na(race) == FALSE) %>%
  group_by(race) %>% 
  tally()) %>% 
  arrange(desc(n))


# update the long format data
rec_long_accent <- rec_long_accent %>% 
  dplyr::select(-(contains("A_") | contains("block_"))) %>% 
  mutate(white_or_not = ifelse(is.na(race), NA, ifelse(race == '1. White', 'White', 'Non-white')),
         race_group =  ifelse(is.na(race), NA, ifelse(race == '1. White', 'white', ifelse(race == '4. Chinese', 'Chinese', 'Others'))))


rec_long_race <- rec_long_race %>% 
  dplyr::select(-(contains("A_") | contains("block_"))) %>% 
  mutate(white_or_not = ifelse(is.na(race), NA, ifelse(race == '1. White', 'White', 'Non-white')),
         race_group =  ifelse(is.na(race), NA, ifelse(race == '1. White', 'White', ifelse(race == '4. Chinese', 'Chinese', 'Others'))))
```

### Accent 

```{r viz: speaker accent vs. respondent white/non-white}
rec_long_accent %>%
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(white_or_not, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE)) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=white_or_not))+
  geom_point() + 
  geom_line(aes(group = white_or_not)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean Score') + 
  scale_colour_discrete('Race of Participants') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 



rec_long_accent %>%
  filter(is.na(white_or_not) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=white_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Race of Respondents') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


```

```{r wilcox: speaker accent vs. respondent white/non-white}
# for each accent
rec_long_accent %>%
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(speaker_accent) %>% 
  wilcox_test(score ~ white_or_not)
```


```{r viz: speaker accent vs. respondent race group}
rec_long_accent %>%
  mutate(race_group = replace(race_group, race_group == 'white', 'White')) %>%
  filter(is.na(race_group) == FALSE) %>%
  group_by(race_group, speaker_accent) %>%
  summarise(mu = mean(score, na.rm = TRUE), count = n()) %>% 
  ggplot(aes(x=speaker_accent, y=mu,col=race_group))+
  geom_point() + 
  geom_line(aes(group = race_group)) + 
  theme_bw() + 
  labs(x = 'Accent', y = 'Mean score') + 
  scale_colour_discrete('Race of participants', labels = c('Chinese (N = 22)', 'Others (N = 37)', 'White (N = 34)')) + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x = element_text(size = 10)) 



rec_long_accent %>%
  filter(is.na(race_group) == FALSE) %>% 
  mutate(race_group = replace(race_group, race_group == 'white', 'White')) %>%
  ggplot(aes(y = score, x = speaker_accent, fill=race_group)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Speaker Accent', y = 'Score',fill='Race of Respondents') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 


```
```{r KW: speaker accent vs. respondent race group}
# for each accent
rec_long_accent %>%
  filter(is.na(race_group) == FALSE) %>%
  group_by(speaker_accent) %>% 
  kruskal_test(score ~ race_group)
```


### Race 

```{r boxplot: speaker race vs. respondent white/non-white}
rec_long_race %>%
  filter(is.na(white_or_not) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_race, fill=white_or_not)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Race of Speakers', y = 'Score',fill='Race of Respondents') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 
```

```{r tests: speaker race vs. respondent white/non-white}
# for each accent
rec_long_race %>%
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(speaker_race) %>% 
  wilcox_test(score ~ white_or_not)

# two races 
bind_cols(
rec_long_race %>% 
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(white_or_not, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(white_or_not) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))
```

```{r boxplot: speaker race vs. respondent race group}
rec_long_race %>%
  filter(is.na(race_group) == FALSE) %>%
  ggplot(aes(y = score, x = speaker_race, fill=race_group)) +
  geom_boxplot() + 
  theme_bw() + 
  labs(x = 'Race of Speakers', y = 'Score',fill='Race of Respondents') + 
  theme(axis.title.x = element_text(size = 12,face = 'bold', hjust = 0.5, vjust = -0.6),
        axis.title.y = element_text(size = 12,face = 'bold', vjust = 3, hjust = 0.5),
        strip.text = element_text(size=12),
        axis.text.y = element_text(size = 10),
        axis.text.x= element_text(size = 10, hjust = 0.5)) 
```

```{r tests: speaker race vs. respondent white/non-white}
# for each accent
rec_long_race %>%
  filter(is.na(race_group) == FALSE) %>%
  group_by(speaker_race) %>% 
  kruskal_test(score ~ race_group)

# two races 
bind_cols(
rec_long_race %>% 
  filter(is.na(race_group) == FALSE) %>%
  group_by(race_group, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(race_group) == FALSE) %>%
  group_by(race_group) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))
```

```{r}
# white or not white
bind_cols(
rec_long_race %>% 
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(white_or_not, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(white_or_not) == FALSE) %>%
  group_by(white_or_not) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))


########################################### race group
bind_cols(
rec_long_race %>% 
  filter(is.na(race_group) == FALSE) %>%
  group_by(race_group, speaker_race) %>%
  summarise(race_mean = mean(score)) %>%
  mutate_at(vars(race_mean), funs(round(., 2))) %>%
  tidyr::pivot_wider(names_from = speaker_race, values_from = race_mean),

rec_long_race %>%
  filter(is.na(race_group) == FALSE) %>%
  group_by(race_group) %>%
  wilcox_test(score ~ speaker_race) %>%
  mutate_at(vars(p), funs(round(., 3))) %>% 
  mutate_at(vars(statistic), funs(round(., 1))) %>% 
  dplyr::select(statistic, p))


```









